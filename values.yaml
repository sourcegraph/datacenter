# const defines configuration constants that generally should not be changed unless testing out experimental or pre-release features.
const:
  frontend:
    image: docker.sourcegraph.com/frontend:15753_2018-05-18_d34b250
  searcher:
    image: docker.sourcegraph.com/searcher:14232_2018-04-13_770f492
  symbols:
    image: docker.sourcegraph.com/symbols:13932_2018-04-09_b6883b9
  gitserver:
    image: docker.sourcegraph.com/gitserver:15719_2018-05-18_031f34b
  githubProxy:
    image: docker.sourcegraph.com/github-proxy:11943_2018-02-23_8bfb2ee
  indexedSearch:
    image: docker.sourcegraph.com/zoekt:18-05-21_71d89f8
  indexer:
    image: docker.sourcegraph.com/indexer:14412_2018-04-20_fddd20b
  lspProxy:
    image: docker.sourcegraph.com/lsp-proxy:14260_2018-04-16_be94954
  queryRunner:
    image: docker.sourcegraph.com/query-runner:14411_2018-04-20_fddd20b
  repoUpdater:
    image: docker.sourcegraph.com/repo-updater:14230_2018-04-13_770f492
  pgsql:
    exporterImage: docker.sourcegraph.com/pgsql-exporter:a294a9b6d83c139d3e1217f02c8f80a54cbf73ac
    image: docker.sourcegraph.com/postgres:9.4
  xlangGo:
    image: docker.sourcegraph.com/xlang-go:15184_2018-05-10_31c2921
  xlangJava:
    image: docker.sourcegraph.com/xlang-java-skinny:2018-05-10-1621
  xlangJavascriptTypescript:
    image: docker.sourcegraph.com/xlang-javascript-typescript:00035_2018-04-26_8701864
  xlangPython:
    image: docker.sourcegraph.com/xlang-python:13187_2018-03-22_b2b49c2
  xlangPHP:
    image: docker.sourcegraph.com/xlang-php:00006_2017-11-09_6ead48c

# cluster specifies the Docker images to use for each service along with replica counts and resource specs where they
# are tunable.
cluster:
  frontend:
    replicas: 1
    containers:
      frontend:
        limits:
          cpu: "2"
          memory: 2G
        requests:
          cpu: "2"
          memory: 1G
  searcher:
    replicas: 1
    containers:
      searcher:
        limits:
          cpu: "2"
          memory: 2G
        requests:
          cpu: "500m"
          memory: "500M"
  symbols:
    replicas: 1
    containers:
      symbols:
        limits:
          cpu: "2"
          memory: 2G
        requests:
          cpu: "500m"
          memory: "500M"
  gitserver:
    shards: 1
    containers:
      gitserver:
        limits:
          cpu: "4"
          memory: 8G
        requests:
          cpu: "500m"
          memory: 1G
  indexedSearch:
    containers:
      # zoekt-indexserver is CPU bound. The more CPU you allocate to it, the
      # lower lag between a new commit and it being indexed for search.
      zoekt-indexserver:
        limits:
          cpu: "4"
          memory: 4G
        requests:
          cpu: "500m"
          memory: 2Gi
      zoekt-webserver:
        limits:
          cpu: "2"
          memory: 4G
        requests:
          cpu: "500m"
          memory: 2Gi
    # # Uncomment this to add a Kubernetes node selector to the pods. This is usually unnecessary for most components, unless
    # # you have a heterogeneous cluster where you need to ensure certain more resource-hungry pods (e.g., indexedSearch) are
    # # assigned to larger nodes.
    # nodeSelector:
    #   beta.kubernetes.io/instance-type: i3.4xlarge
  lspProxy:
    containers:
      lsp-proxy:
        limits:
          cpu: "1"
          memory: 8Gi
        requests:
          cpu: "500m"
          memory: 2Gi
  xlangGo:
    replicas: 1
    containers:
      xlang-go:
        limits:
          cpu: "4"
          memory: 8Gi
        requests:
          cpu: "500m"
          memory: 2Gi
  xlangJava:
    replicas: 1
    containers:
      xlang-java:
        limits:
          cpu: "4"
          memory: 8Gi
        requests:
          cpu: "500m"
          memory: 2Gi
  xlangJavascriptTypescript:
    replicas: 1
    containers:
      xlang-javascript-typescript:
        limits:
          cpu: "4"
          memory: 5Gi
        requests:
          cpu: "500m"
          memory: 2Gi
  xlangPython:
    replicas: 1
    containers:
      xlang-python:
        limits:
          cpu: "500m"
          memory: 1G
        requests:
          cpu: "500m"
          memory: 1G
  xlangPHP:
    replicas: 1
    containers:
      xlang-php:
        limits:
          cpu: "4"
          memory: 8Gi
        requests:
          cpu: "500m"
          memory: 2Gi
  storageClass:
    # name is the name of the storage class used by the persistent volumes generated in this chart. This should be
    # left as is, unless you are using an already existing storage class.
    name: default

    # # REQUIRED: create should be set to "gcp", "aws", or "no". Setting to "gcp" or "aws" will create a new storage class for
    # # the designated infrastructure provider. If set to "none", a storage class with the designated name must be
    # # created separately from the config generated by this chart
    # create: none

    # # zone should be set to the zone in which your Kubernetes cluster resides
    # zone: us-west1-a

  # # securityContext, if set, overrides the standard pod security context in all pods
  # securityContext:
  #   fsGroup: 1000

# site is the Sourcegraph site configuration.
#
# For legacy reasons, it can include some configuration fields that are only relevant to Data Center.
#
# See all site config options at https://about.sourcegraph.com/docs/config/settings.
site: {
  # Publicly accessible URL to web app (e.g., what you type into your browser).
  "appURL": "http://localhost:3080",

  # Port exposed on all nodes directing HTTP traffic to sourcegraph-frontend pod.
  "httpNodePort": 30080,

  # Allows new visitors to sign up for accounts. The sign-up page will be enabled and accessible to all visitors.
  #
  # SECURITY: If the site has no users (i.e., during initial setup), it will always allow the first user to sign up and become site admin without any approval (first user to sign up becomes the admin).
  #
  # Requires auth.provider == "builtin".
  "auth.allowSignup": true,

  # The authentication provider to use for identifying and signing in users. Defaults to built-in authentication.
  #
  # This element must be one of the following enum values:
  #
  #   builtin
  #   openidconnect
  #   saml
  #   http-header
  "auth.provider": "builtin",

  # The size of disk to use for each gitserver instance
  "gitserverDiskSize": "200Gi",

  # The size of disk to used for search indexes (this should typically be the gitserverDiskSize multipled by the number of gitserver shards)
  "indexedSearchDiskSize": "200Gi",

  # Uncomment the languages for which you wish to enable code intelligence
  "langservers": [
    # {
    #   "language": "go",
    # },
    # {
    #   "language": "java",
    # },
    # {
    #   "language": "javascript",
    # },
    # {
    #   "language": "typescript",
    # },
    # {
    #   "language": "python",
    # },
    # {
    #   "language": "php",
    # },

    # WARNING experimental language servers follow - read about the caveats
    # before enabling them:
    # https://about.sourcegraph.com/docs/code-intelligence/experimental-language-servers#caveats-of-experimental-language-servers
    # {
    #   "language": "bash",
    # },
    # {
    #   "language": "clojure",
    # },
    # {
    #   "language": "cpp",
    # },
    # {
    #   "language": "cs",
    # },
    # {
    #   "language": "css",
    # },
    # {
    #   "language": "dockerfile",
    # },
    # {
    #   "language": "elixir",
    # },
    # {
    #   "language": "html",
    # },
    # {
    #   "language": "lua",
    # },
    # {
    #   "language": "ocaml",
    # },
    # {
    #   "language": "r",
    # },
    # {
    #   "language": "ruby",
    # },
    # {
    #   "language": "rust",
    # },
  ],

  # RBAC is enabled by default. Some Kubernetes environments do not permit RBAC. Set to "disabled" to disable and prevent RBAC objects from being generated.
  "rbac": "enabled",
}
